# Native Android App Development Rules & Best Practices

## üîç Pre-Flight Checklist (Do this BEFORE coding)

### 1. Project Setup & Gradle
- **Plugin Management**: Immediately add `google()` and `mavenCentral()` to `pluginManagement` in `settings.gradle.kts`. *Prevents: Plugin resolution errors.*
- **AndroidX**: Ensure `android.useAndroidX=true` is in `gradle.properties`. *Prevents: Legacy support library crashes.*
- **Java Version**: Set `sourceCompatibility` and `jvmTarget` to `1.8` (or 11/17) in `app/build.gradle.kts`. *Prevents: Kotlin/Java version mismatch errors.*
- **Dependencies**: 
    - Verify library versions! (e.g., Media3 `1.2.0` lacks `Effects` vs `1.3.1`).
    - *Tip*: If you see `Unresolved Reference` for a class you *know* exists, check the library version first.

### 2. Resources & Assets
- **Drawables First**: Create vector assets (`ic_launcher`, icons) *before* referencing them in layouts. *Prevents: "Resource not found" build errors.*
- **Permissions**: Add `<uses-permission>` (e.g., `READ_MEDIA_VIDEO`) to `AndroidManifest.xml` immediately.

---

## üõ°Ô∏è Coding Rules & Error Prevention

### 3. UI/Layouts (The "Clickable" Trap)
- **Z-Order Rule**: In XML, the element defined **LAST** draws on **TOP**. 
    - *Mistake*: Placing a full-screen `FrameLayout` (overlay) *after* buttons makes buttons unclickable.
    - *Fix*: Define controls (`LinearLayout`, `buttons`) at the very end of the XML file.
- **Button Sizing**: Minimum tappable area is 48dp. Use `60dp` for comfortable media controls.

### 4. Code Editing Hygiene (Agent Specific)
- **Watch Imports**: When using `replace_file_content` to swap a function, **DO NOT** delete the `import` statements at the top of the file.
    - *Prevention*: When modifying a class, glance at the top of the file or simply re-state necessary imports if doing a large block replacement.
- **restore Missing Imports**: If compilation fails with "Unresolved reference: RecyclerView/ViewBinding", checking the imports block is the first debugging step.

### 5. Logic & Performance
- **Seek Accumulation**: 
    - *Problem*: Scrubbing "freezes" or stutters when moving slowly.
    - *Cause*: `player.currentPosition` snaps to keyframes, discarding small scroll deltas.
    - *Fix*: **Independent State Tracking**. Maintain a local variable (`scrubPosition += delta`) and strictly use that to tell the player where to go.
- **Hardware Acceleration**: Explicitly enable `android:hardwareAccelerated="true"` in Manifest for video apps.

### 6. Media3 Specifics
- **Seek Parameters**: default is `exact`, which is slow. Use `SeekParameters.PREVIOUS_SYNC` for performance scrubbing (snaps to keyframes).
- **Transformer**: For editing/cropping, ensure `media3-effect` dependency is included.

---

## üöÄ Efficiency Tips for Future Builds
1.  **Start with a Data Class**: When building lists, define the model (`Video.kt`) first, then the Adapter.
2.  **Glide/Coil Early**: Don't waste time with placeholder images; add Glide dependency in step 1.
3.  **Persist Work**: If the app scans folders, save the URIs (`SharedPreferences`) so the user doesn't have to re-pick them on every launch.

*Generated by Antigravity Agent - 2025*
